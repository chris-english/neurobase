<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NIfTI Basics using the Eve atlas • neurobase</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="NIfTI Basics using the Eve atlas">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">neurobase</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.29.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/neurobase.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/nifti_basics.html">The nifti object</a>
    </li>
    <li>
      <a href="../articles/simple_io.html">Simple Image Input/Output</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="neurobase_files/jquery-1.11.3/jquery.min.js"></script><script src="neurobase_files/elevate-section-attrs-2.0/elevate-section-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>NIfTI Basics using the Eve atlas</h1>
                        <h4 class="author">John Muschelli</h4>
            
            <h4 class="date">2020-01-14</h4>
      
      
      <div class="hidden name"><code>neurobase.Rmd</code></div>

    </div>

    
    
<div id="the-nifti-object" class="section level1">
<h1 class="hasAnchor">
<a href="#the-nifti-object" class="anchor"></a>The nifti object</h1>
<p>Note: Throughout this post, I will refer to an image on hard disk as a NIfTI, which is a file that generally has the extension “.nii” or “.nii.gz”. I will refer to the object in R as a <code>nifti</code> (note the change of font and case).</p>
<p>In this tutorial we will discuss the basics of the <code>nifti</code> object in R. There are many objects in R that represent imaging data. The Neuroconductor project chose the <code>nifti</code> object from the <code>oro.nifti</code> package as one of the the basic building blocks because it has been widely used in other packages, has been tested over a period of time, and inherits the properties of an <code>array</code> in R.</p>
<div id="s4-implementation" class="section level2">
<h2 class="hasAnchor">
<a href="#s4-implementation" class="anchor"></a>S4 Implementation</h2>
<p>As <code>nifti</code> objects inherits the properties of an <code>array</code>, you can perform a series of operations on them, such as addition/subtraction/division, as you would an <code>array</code>. A <code>nifti</code> object has additional attributes and the <code>nifti</code> object is an S4 object. This means that you do not reference additional information using the <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code> operator.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(oro.nifti)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">20161007</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a>dims =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">10</span>, <span class="dv">3</span>)</span>
<span id="cb1-4"><a href="#cb1-4"></a>arr =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="dv">10</span><span class="op">*</span><span class="dv">10</span><span class="op">*</span><span class="dv">10</span>), <span class="dt">dim =</span> dims)</span>
<span id="cb1-5"><a href="#cb1-5"></a>nim =<span class="st"> </span>oro.nifti<span class="op">::</span><span class="kw">nifti</span>(arr)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(nim)</span></code></pre></div>
<pre><code>## NIfTI-1 format
##   Type            : nifti
##   Data Type       : 2 (UINT8)
##   Bits per Pixel  : 8
##   Slice Code      : 0 (Unknown)
##   Intent Code     : 0 (None)
##   Qform Code      : 0 (Unknown)
##   Sform Code      : 0 (Unknown)
##   Dimension       : 10 x 10 x 10
##   Pixel Dimension : 1 x 1 x 1
##   Voxel Units     : Unknown
##   Time Units      : Unknown</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span>(nim))</span></code></pre></div>
<pre><code>## [1] "nifti"
## attr(,"package")
## [1] "oro.nifti"</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>oro.nifti<span class="op">::</span><span class="kw">is.nifti</span>(nim)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div id="accessing-information-from-a-nifti" class="section level3">
<h3 class="hasAnchor">
<a href="#accessing-information-from-a-nifti" class="anchor"></a>Accessing Information from a <code>nifti</code>
</h3>
<p>To access additional information, called a slot, you can use the <code>@</code> operator. We do not recommend this, as there should be a function implemented to “access” this slot. These are hence called accessor functions (they access things!). For example, if you want to get the <code>cal_max</code> slot of a <code>nifti</code> object, you should use the <code>cal_max</code> function. If an accessor function is not implemented, you should still use the <code>slot(object, name)</code> syntax over <code>@</code>.</p>
<p>Here’s an example where we make an array of random normal data, and put that array into a <code>nifti</code> object with the <code>nifti</code> function:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>nim<span class="op">@</span>cal_max</span></code></pre></div>
<pre><code>## [1] 2.706524</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw"><a href="https://rdrr.io/pkg/oro.nifti/man/cal_max-methods.html">cal_max</a></span>(nim)</span></code></pre></div>
<pre><code>## [1] 2.706524</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">slot</span>(nim, <span class="st">"cal_max"</span>)</span></code></pre></div>
<pre><code>## [1] 2.706524</code></pre>
</div>
<div id="accessing-the-data" class="section level3">
<h3 class="hasAnchor">
<a href="#accessing-the-data" class="anchor"></a>Accessing the “data”</h3>
<p>If you want to access the “data” of the image, you can access that using:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>data =<span class="st"> </span><span class="kw">slot</span>(nim, <span class="st">".Data"</span>)</span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span>(data)</span></code></pre></div>
<pre><code>## [1] "array"</code></pre>
<p>With newer versions of <code>oro.nifti</code> (especially that on GitHub and in Neuroconductor), there is a <code>img_data</code> function to access the data:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>data =<span class="st"> </span>oro.nifti<span class="op">::</span><span class="kw">img_data</span>(nim)</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span>(data)</span></code></pre></div>
<pre><code>## [1] "array"</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(data)</span></code></pre></div>
<pre><code>## [1] 10 10 10</code></pre>
<p>This <code>array</code> is 3-dimensional and can be subset using normal square-bracket notations (<code>[row, column, slice]</code>). Thus, if we want the 3rd “slice” of the image, we can use:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>slice =<span class="st"> </span>data[,,<span class="dv">3</span>]</span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span>(slice)</span></code></pre></div>
<pre><code>## [1] "matrix"</code></pre>
<p>Thus we see we get a matrix of values from the 3rd “slice”. We should note that we generally reference an image by x, y, and z planes (in that order). Most of the time, the x direction refers to going left/right on an image, y refers to front/back (or anterior/posterior), and the z direction refers to up/down (superior/inferior). The actual direction depends on the header information of the NIfTI image.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>slice =<span class="st"> </span>data[,,<span class="dv">3</span>, drop =<span class="st"> </span><span class="ot">FALSE</span>]</span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span>(slice)</span></code></pre></div>
<pre><code>## [1] "array"</code></pre>
</div>
<div id="show-all-slots" class="section level3">
<h3 class="hasAnchor">
<a href="#show-all-slots" class="anchor"></a>Show all slots</h3>
<p>You can see which slots exist for a <code>nifti</code> object by using <code>slotNames</code></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="kw">slotNames</span>(nim)</span></code></pre></div>
<pre><code>##  [1] ".Data"          "sizeof_hdr"     "data_type"      "db_name"       
##  [5] "extents"        "session_error"  "regular"        "dim_info"      
##  [9] "dim_"           "intent_p1"      "intent_p2"      "intent_p3"     
## [13] "intent_code"    "datatype"       "bitpix"         "slice_start"   
## [17] "pixdim"         "vox_offset"     "scl_slope"      "scl_inter"     
## [21] "slice_end"      "slice_code"     "xyzt_units"     "cal_max"       
## [25] "cal_min"        "slice_duration" "toffset"        "glmax"         
## [29] "glmin"          "descrip"        "aux_file"       "qform_code"    
## [33] "sform_code"     "quatern_b"      "quatern_c"      "quatern_d"     
## [37] "qoffset_x"      "qoffset_y"      "qoffset_z"      "srow_x"        
## [41] "srow_y"         "srow_z"         "intent_name"    "magic"         
## [45] "extender"       "reoriented"</code></pre>
<p>If you would like to see information about each one of these slots, please see <a href="https://brainder.org/2012/09/23/the-nifti-file-format/">this blog post</a> about the NIfTI header.</p>
</div>
</div>
</div>
<div id="other-objects" class="section level1">
<h1 class="hasAnchor">
<a href="#other-objects" class="anchor"></a>Other objects</h1>
<p>Other packages, such as <code>ANTsR</code> and <code>RNifti</code> have implemented faster reading/writing functions of NIfTI images. These rely on pointers to object in memory and are very useful. They have specific implementations for extracting information from them and saving them out, such as in an Rda/rda (R data file). A series of conversion tools for <code>ANTsR</code> objects are included in the <code>extrantsr</code> package (function <code>ants2oro</code>) and <code>nii2oro</code> in <code>oro.nifti</code> for RNifti objects.</p>
</div>
<div id="nifti-inputoutput-readniiwritenii-vs--readniftiwritenifti" class="section level1">
<h1 class="hasAnchor">
<a href="#nifti-inputoutput-readniiwritenii-vs--readniftiwritenifti" class="anchor"></a>NIfTI Input/Output: <code>readnii</code>/<code>writenii</code> vs. <code>readNIfTI</code>/<code>writeNIfTI</code>
</h1>
<p>In the <code>neurobase</code> package, we provide wrapper functions <code>readnii</code>/<code>writenii</code>, which wrap the <code>oro.nifti</code> functions <code>readNIfTI</code>/<code>writeNIfTI</code>. There are a few reasons for this:</p>
<ol style="list-style-type: decimal">
<li>You can pass a filename with a “.nii.gz” extension to <code>writenii</code> and an additional “.nii.gz” will not be added, whereas this will happen in <code>writeNIfTI</code>.</li>
<li>
<code>writenii</code> will try to discern the data type of the image before writing, which may be useful if you created a <code>nifti</code> by copying information from a previous <code>nifti</code> object.</li>
<li>The default in <code>readnii</code> is <code>reorient = FALSE</code>, which generally does not error when reading in data, whereas <code>readNIfTI</code> defaults to <code>reorient = TRUE</code>. This is discussed below.</li>
<li>Extraneous dimensions are automatically deleted with <code>readnii</code>. Note this may cause errors and is <strong>not desired 100% of the time</strong>.</li>
</ol>
<div id="option-reorient-false" class="section level2">
<h2 class="hasAnchor">
<a href="#option-reorient-false" class="anchor"></a>Option <code>reorient = FALSE</code>
</h2>
<p>In <code>readNIfTI</code> default <code>reorient = TRUE</code> implicitly uses the <code>reorient</code> function from <code>oro.nifti</code>. Although many neuroimaging software suites read the header and reorient the data based on that information, <code><a href="https://rdrr.io/pkg/oro.nifti/man/reorient.html">oro.nifti::reorient</a></code> can only handle simple orientations, see <code><a href="https://rdrr.io/pkg/oro.nifti/man/performPermutation.html">oro.nifti::performPermutation</a></code> documentation. Although reading the data in without reorienting can cause problems, such as not knowing right/left orientation, if multiple NIfTI files were created in the same way (assumingly from <code>dcm2nii</code>), they should ideally have the same orientation.</p>
<p>Derived data from an image will have the exact same orientation because derived <code>nifti</code> objects will copy the <code>nifti</code> header information from the <code>nifti</code> object it was derived from. Moreover, in many analyses, registration to an image or a template is common, and these have known orientations. We have found that if a user wants to reorient their data in R, using the <code>reorient</code> function can be used, but we prefer the default to be <code>FALSE</code>, otherwise reading in many NIfTI files result in an error from the orientation.</p>
</div>
</div>
<div id="operations-of-nifti-objects" class="section level1">
<h1 class="hasAnchor">
<a href="#operations-of-nifti-objects" class="anchor"></a>Operations of <code>nifti</code> objects</h1>
<p>Although the <code>nifti</code> object is not a standard R object, you can perform standard operations on these objects, such as addition/subtraction and logic. This is referred to “overloaded” operators.</p>
<div id="logical-operators" class="section level2">
<h2 class="hasAnchor">
<a href="#logical-operators" class="anchor"></a>Logical operators</h2>
<p>For example, if we want to create a <code>nifti</code> object with binary values, where the values are <code>TRUE</code> if the values in <code>nim</code> are greater than 0, we can simply write:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>above_zero =<span class="st"> </span>nim <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span>(above_zero)</span></code></pre></div>
<pre><code>## [1] "nifti"
## attr(,"package")
## [1] "oro.nifti"</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="kw"><a href="https://rdrr.io/pkg/oro.nifti/man/img_data-methods.html">img_data</a></span>(above_zero)[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>We will refer to binary images/<code>nifti</code> objects as “masks”.</p>
<p>We can combine multiple operators, such as creating a binary mask for value greater than 0 and less than 2.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span>(nim <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>nim <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] "nifti"
## attr(,"package")
## [1] "oro.nifti"</code></pre>
</div>
<div id="arithmetic-on-nifti-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#arithmetic-on-nifti-objects" class="anchor"></a>Arithmetic on <code>nifti</code> objects</h2>
<p>We can also show the</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span>(nim <span class="op">*</span><span class="st"> </span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] "nifti"
## attr(,"package")
## [1] "oro.nifti"</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span>(nim <span class="op">+</span><span class="st"> </span>(nim <span class="op">/</span><span class="st"> </span><span class="dv">4</span>))</span></code></pre></div>
<pre><code>## [1] "nifti"
## attr(,"package")
## [1] "oro.nifti"</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span>(nim <span class="op">*</span><span class="st"> </span>nim)</span></code></pre></div>
<pre><code>## [1] "nifti"
## attr(,"package")
## [1] "oro.nifti"</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span>(nim<span class="op">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] "nifti"
## attr(,"package")
## [1] "oro.nifti"</code></pre>
</div>
<div id="summaries" class="section level2">
<h2 class="hasAnchor">
<a href="#summaries" class="anchor"></a>Summaries</h2>
<p>How many values actually are greater than zero? Here, we can use standard statistical functions, such as <code>sum</code> to count the number of <code>TRUE</code> indices:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(above_zero)</span></code></pre></div>
<pre><code>## [1] 513</code></pre>
<p>and similarly find the proportion of <code>TRUE</code> indices by taking the <code>mean</code> of these indicators:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(above_zero)</span></code></pre></div>
<pre><code>## [1] 0.513</code></pre>
<p>Again, as <code>nifti</code> is an S4 object, it should have the functionality described in the details of the help file for <code><a href="https://rdrr.io/r/methods/S4groupGeneric.html">methods::S4groupGeneric</a></code>:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(nim)</span></code></pre></div>
<pre><code>## [1] -3.517075</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(nim)</span></code></pre></div>
<pre><code>## [1] 2.706524</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="kw"><a href="https://rdrr.io/r/base/range.html">range</a></span>(nim)</span></code></pre></div>
<pre><code>## [1] -3.517075  2.706524</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(nim))</span></code></pre></div>
<pre><code>## [1] "nifti"
## attr(,"package")
## [1] "oro.nifti"</code></pre>
</div>
</div>
<div id="visualization-of-nifti-objects" class="section level1">
<h1 class="hasAnchor">
<a href="#visualization-of-nifti-objects" class="anchor"></a>Visualization of <code>nifti</code> objects</h1>
<p>Here we will use imaging data from the <code>oro.nifti</code> package:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>fname =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(</span>
<span id="cb51-2"><a href="#cb51-2"></a>  <span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"nifti"</span>, <span class="st">"mniRL.nii.gz"</span>),</span>
<span id="cb51-3"><a href="#cb51-3"></a>  <span class="dt">package =</span> <span class="st">"oro.nifti"</span>)</span>
<span id="cb51-4"><a href="#cb51-4"></a>eve =<span class="st"> </span><span class="kw"><a href="../reference/readNIfTI2.html">readnii</a></span>(fname)</span></code></pre></div>
<div id="orthographic-view" class="section level2">
<h2 class="hasAnchor">
<a href="#orthographic-view" class="anchor"></a>Orthographic view</h2>
<p>The <code><a href="https://rdrr.io/pkg/oro.nifti/man/orthographic-methods.html">oro.nifti::orthographic</a></code> function provides great functionality on displaying <code>nifti</code> objects in 3 different planes.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a>oro.nifti<span class="op">::</span><span class="kw">orthographic</span>(eve)</span></code></pre></div>
<p><img src="neurobase_files/figure-html/ortho-1.png" width="700"></p>
<p>The <code><a href="../reference/ortho2.html">neurobase::ortho2</a></code> function expands upon this with some different defaults.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>neurobase<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/neurobase/man/ortho2.html">ortho2</a></span>(eve)</span></code></pre></div>
<p><img src="neurobase_files/figure-html/ortho2-1.png" width="700"></p>
<p>We see that in <code>ortho2</code> there are annotations of the orientation of the image. Again, if the image was not reoriented, then these many not be correct. You can turn these off with the <code>add.orient</code> argument:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a>neurobase<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/neurobase/man/ortho2.html">ortho2</a></span>(eve, <span class="dt">add.orient =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="neurobase_files/figure-html/ortho2_noorient-1.png" width="700"></p>
<div id="differences-between-orthographic-and-ortho2" class="section level3">
<h3 class="hasAnchor">
<a href="#differences-between-orthographic-and-ortho2" class="anchor"></a>Differences between <code>orthographic</code> and <code>ortho2</code>
</h3>
<p>The above code does not fully illustrate the differences between <code>orthographic</code> and <code>ortho2</code>. One marked difference is when you would like to “overlay” an image on top of another in an orthograhic view. Here we will highlight voxels greater than the 90th quantile of the image:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="kw"><a href="https://rdrr.io/pkg/oro.nifti/man/orthographic-methods.html">orthographic</a></span>(eve, <span class="dt">y =</span> eve <span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(eve, <span class="fl">0.9</span>))</span></code></pre></div>
<p><img src="neurobase_files/figure-html/ortho_nona-1.png" width="700"></p>
<p>We see that the white matter is represented here, along with the burned in orientations, but we would like to see areas of the brain that are not over this quantile to be shown as the image. Let us contrast this with:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a><span class="kw"><a href="../reference/ortho2.html">ortho2</a></span>(eve, <span class="dt">y =</span> eve <span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(eve, <span class="fl">0.9</span>))</span></code></pre></div>
<p><img src="neurobase_files/figure-html/ortho2_nona-1.png" width="700"></p>
<p>We see the image where the mask is 0 shows the original image. This is due to the <code>NA.y</code> argument in <code>ortho2</code>. The <code>ortho2</code> (and <code>orthograhic</code>) function is based on the <code><a href="https://rdrr.io/r/graphics/image.html">graphics::image</a></code> function in R, as well as many other functions we will discuss below. When <code><a href="https://rdrr.io/r/graphics/image.html">graphics::image</a></code> sees an <code>NA</code> value, it does not plot anything there. The <code>NA.y</code> argument in <code>ortho2</code> makes it so any values in the <code>y</code> argument (in this case the mask) that are equal to zero are turned to <code>NA</code>.</p>
</div>
<div id="bright-values" class="section level3">
<h3 class="hasAnchor">
<a href="#bright-values" class="anchor"></a>Bright values</h3>
<p>If you have artifacts or simply large values of an image, it can “dampen” the viewing of an image. Let’s make one value of the eve template very large. We will set the voxel with the largest value to be that value times 5 :</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>eve2 =<span class="st"> </span>eve</span>
<span id="cb57-2"><a href="#cb57-2"></a>eve2[<span class="kw"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span>(eve)] =<span class="st"> </span>eve2[<span class="kw"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span>(eve)] <span class="op">*</span><span class="st"> </span><span class="dv">5</span></span></code></pre></div>
<p>Let’s plot this image again:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a><span class="kw"><a href="../reference/ortho2.html">ortho2</a></span>(eve2)</span></code></pre></div>
<p><img src="neurobase_files/figure-html/ortho2_large-1.png" width="700"></p>
<p>We see a faint outline of the image, but this single large value affects how we view the image. The function <code>robust_window</code> calculates quantiles of an image, by default the 0 (min) and 99.9th quantile, and sets values outside of this range to that quantile. If you are familiar with the process of <a href="https://en.wikipedia.org/wiki/Winsorizing">Winsorizing</a>, this is the exact same procedure. Many times we use this function to plotting, but could be thought of an outlier dampening procedure. Let’s plot this windowed image:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="kw"><a href="../reference/ortho2.html">ortho2</a></span>(<span class="kw"><a href="../reference/robust_window.html">robust_window</a></span>(eve2))</span></code></pre></div>
<p><img src="neurobase_files/figure-html/ortho2_rob-1.png" width="700"></p>
<p>Changing the <code>probs</code> argument in <code>robust_window</code>, which is passed to <code>quantile</code>, can also be used to limit artifacts with remarkably low values. The <code>zlim</code> option can also denote which range of intensities that can be plotted:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a><span class="kw"><a href="../reference/ortho2.html">ortho2</a></span>(eve2, <span class="dt">zlim =</span> <span class="kw"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(eve2, <span class="dt">probs =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="fl">0.999</span>)))</span></code></pre></div>
<p><img src="neurobase_files/figure-html/ortho2_zlim-1.png" width="700"></p>
<p>This is a bit more like trimming, however.</p>
</div>
<div id="double-orthographic-view" class="section level3">
<h3 class="hasAnchor">
<a href="#double-orthographic-view" class="anchor"></a>Double orthographic view</h3>
<p>Sometimes you would like to represent 2 images side by side, of the same dimensions and orientation of course. The <code>double_ortho</code> function allows you to do this. Let’s read in the flipped image:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a>flipped_fname =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(</span>
<span id="cb61-2"><a href="#cb61-2"></a>  <span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"nifti"</span>, <span class="st">"mniLR.nii.gz"</span>),</span>
<span id="cb61-3"><a href="#cb61-3"></a>  <span class="dt">package =</span> <span class="st">"oro.nifti"</span>)</span>
<span id="cb61-4"><a href="#cb61-4"></a>flipped_eve =<span class="st"> </span><span class="kw"><a href="../reference/readNIfTI2.html">readnii</a></span>(flipped_fname)</span></code></pre></div>
<p>We can view the flipped T1 alongside the original image:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="kw"><a href="../reference/double_ortho.html">double_ortho</a></span>(flipped_eve, eve)</span></code></pre></div>
<p><img src="neurobase_files/figure-html/double_ortho-1.png" width="700"></p>
</div>
</div>
<div id="single-slice-view" class="section level2">
<h2 class="hasAnchor">
<a href="#single-slice-view" class="anchor"></a>Single slice view</h2>
<p>We may want to view a single slice of an image. The <code>oro.nifti::image</code> function can be used here. Note, <code><a href="https://rdrr.io/r/graphics/image.html">graphics::image</a></code> exists and <code>oro.nifti::image</code> both exist. The <code>oro.nifti::image</code> allows you to just write <code><a href="https://rdrr.io/r/graphics/image.html">image(nifti_object)</a></code>, which performs operations and calls functions using <code><a href="https://rdrr.io/r/graphics/image.html">graphics::image</a></code>. This allows the user to use a “generic” version of <code>image</code>, which <code>oro.nifti</code> adapted specifically for <code>nifti</code> objects. You can see the help for this function in <code><a href="https://rdrr.io/pkg/oro.nifti/man/image-methods.html">?image.nifti</a></code>.</p>
<p>Let’s plot an image of the 90th slice of <code>eve</code></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/image.html">image</a></span>(eve, <span class="dt">z =</span> <span class="dv">45</span>)</span></code></pre></div>
<p><img src="neurobase_files/figure-html/all_slices-1.png" width="700"></p>
<p>What happened? Well, the default argument <code>plot.type</code> in <code>image.nifti</code> is set for <code>"multiple"</code>, so that even if you specify a slice, it will plot <strong>all</strong> slices. Here, if we pass <code>plot.type = "single"</code>, we get the single slice we want.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/image.html">image</a></span>(eve, <span class="dt">z =</span> <span class="dv">45</span>, <span class="dt">plot.type =</span> <span class="st">"single"</span>)</span></code></pre></div>
<p><img src="neurobase_files/figure-html/one_slice-1.png" width="700"></p>
<p>If we put multiple slices with <code>plot.type = "single"</code>, then we will get a view of these 2 slices.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/image.html">image</a></span>(eve, <span class="dt">z =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">45</span>, <span class="dv">50</span>), <span class="dt">plot.type =</span> <span class="st">"single"</span>)</span></code></pre></div>
<p><img src="neurobase_files/figure-html/two_slice-1.png" width="700"></p>
<div id="different-planes" class="section level3">
<h3 class="hasAnchor">
<a href="#different-planes" class="anchor"></a>Different Planes</h3>
<p>We can specify <code>z</code> the same way but change the <code>plane</code> to be different to get a different slice of the brain:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/image.html">image</a></span>(eve, <span class="dt">z =</span> <span class="dv">52</span>, <span class="dt">plot.type =</span> <span class="st">"single"</span>, <span class="dt">plane =</span> <span class="st">"sagittal"</span>)</span></code></pre></div>
<p><img src="neurobase_files/figure-html/one_slice_sag-1.png" width="700"> We can similarly do the same for “coronal” slices.</p>
</div>
</div>
<div id="overlaying-slices" class="section level2">
<h2 class="hasAnchor">
<a href="#overlaying-slices" class="anchor"></a>Overlaying slices</h2>
<p>We can also overlay one slice of an image upon another using the <code><a href="https://rdrr.io/pkg/oro.nifti/man/overlay-methods.html">oro.nifti::overlay</a></code> function. Here we must specify <code>plot.type</code> again for only one slice.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="kw"><a href="https://rdrr.io/pkg/oro.nifti/man/overlay-methods.html">overlay</a></span>(eve, <span class="dt">y =</span> eve <span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(eve, <span class="fl">0.9</span>), <span class="dt">z =</span> <span class="dv">45</span>, <span class="dt">plot.type =</span> <span class="st">"single"</span>)</span></code></pre></div>
<p><img src="neurobase_files/figure-html/one_slice_overlay-1.png" width="700"></p>
<p>We have not yet implemented <code>overlay2</code> (at the time of running this), which has the <code>NA.y</code> option, but will in the future. We can do this prior to plotting and pass in this <code>NA</code>’d mask:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a>mask =<span class="st"> </span>eve <span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(eve, <span class="fl">0.9</span>)</span>
<span id="cb68-2"><a href="#cb68-2"></a>mask[ mask <span class="op">==</span><span class="st"> </span><span class="dv">0</span>] =<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb68-3"><a href="#cb68-3"></a><span class="kw"><a href="https://rdrr.io/pkg/oro.nifti/man/overlay-methods.html">overlay</a></span>(eve, <span class="dt">y =</span> mask, <span class="dt">z =</span> <span class="dv">45</span>, <span class="dt">plot.type =</span> <span class="st">"single"</span>)</span></code></pre></div>
<p><img src="neurobase_files/figure-html/one_slice_overlay_right-1.png" width="700"></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="kw"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="dt">list =</span> <span class="st">"mask"</span>)</span></code></pre></div>
</div>
<div id="dropping-empty-dimensions" class="section level2">
<h2 class="hasAnchor">
<a href="#dropping-empty-dimensions" class="anchor"></a>Dropping empty dimensions</h2>
<p>In some instances, there are extraneous slices to an image. For example, in the image we read in, there are extraneous brackrond. For plotting or further analyses, we can drop these empty dimensions using the <code><a href="../reference/dropEmptyImageDimensions.html">neurobase::dropEmptyImageDimensions</a></code> function or <code>drop_empty_dim</code> shorthand function.<br>
By default, if one <code>nifti</code> is passed to the function and <code>keep_ind = FALSE</code>, then the return is a <code>nifti</code> object.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a>reduced =<span class="st"> </span><span class="kw"><a href="../reference/dropEmptyImageDimensions.html">dropEmptyImageDimensions</a></span>(eve)</span>
<span id="cb70-2"><a href="#cb70-2"></a><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(eve)</span></code></pre></div>
<pre><code>## [1]  91 109  91</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(reduced)</span></code></pre></div>
<pre><code>## [1]  91 109  91</code></pre>
<p>We can now plot the reduced image:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a><span class="kw"><a href="../reference/ortho2.html">ortho2</a></span>(reduced)</span></code></pre></div>
<p><img src="neurobase_files/figure-html/plot_red-1.png" width="700"></p>
<p>which we can contrast with the plotting the full image</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a><span class="kw"><a href="../reference/ortho2.html">ortho2</a></span>(eve)</span></code></pre></div>
<p><img src="neurobase_files/figure-html/plot_full_eve-1.png" width="700"></p>
<div id="dropping-with-multiple-images" class="section level3">
<h3 class="hasAnchor">
<a href="#dropping-with-multiple-images" class="anchor"></a>Dropping with multiple images</h3>
<p>You can pass in other images in the <code>other.imgs</code> function to applying this dropping procedure. For example, let’s say you have 3 images, a T1, T2, and FLAIR image that are all registered to the T1 image and have a brain mask from the T1 image. You can pass in the mask image and pass in the other images into <code>other.imgs</code> so they all drop the same slices and are the same dimensions after the procedure (as they were the same prior), whereas if you performed the operation you may not be ensured to drop exactly the same slices due to some modalities allowing values of zero (albeit highly unlikely).</p>
</div>
<div id="adding-back-the-dropped-dimensions" class="section level3">
<h3 class="hasAnchor">
<a href="#adding-back-the-dropped-dimensions" class="anchor"></a>Adding back the dropped dimensions</h3>
<p>To reverse this procedure, the <code>replace_dropped_dimensions</code> function will add back dimensions to the image correctly using the indices from <code>drop_empty_dim</code>. Here is an example:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a>dd =<span class="st"> </span><span class="kw"><a href="../reference/dropEmptyImageDimensions.html">dropEmptyImageDimensions</a></span>(eve, <span class="dt">keep_ind =</span> <span class="ot">TRUE</span>)</span>
<span id="cb76-2"><a href="#cb76-2"></a>reduced =<span class="st"> </span>dd<span class="op">$</span>outimg</span>
<span id="cb76-3"><a href="#cb76-3"></a>reversed =<span class="st"> </span><span class="kw"><a href="../reference/replace_dropped_dimensions.html">replace_dropped_dimensions</a></span>(<span class="dt">img =</span> reduced, </span>
<span id="cb76-4"><a href="#cb76-4"></a>                                      <span class="dt">inds =</span> dd<span class="op">$</span>inds,</span>
<span id="cb76-5"><a href="#cb76-5"></a>                                      <span class="dt">orig.dim =</span> dd<span class="op">$</span>orig.dim)</span>
<span id="cb76-6"><a href="#cb76-6"></a><span class="kw"><a href="https://rdrr.io/r/base/all.html">all</a></span>(reversed <span class="op">==</span><span class="st"> </span>eve)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
</div>
</div>
<div id="manipulating-nifti-images" class="section level1">
<h1 class="hasAnchor">
<a href="#manipulating-nifti-images" class="anchor"></a>Manipulating <code>nifti</code> images</h1>
<div id="creating-copies-of-nifti" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-copies-of-nifti" class="anchor"></a>Creating copies of <code>nifti</code>
</h2>
<p>Sometimes you want to create a copy of a <code>nifti</code> object. Many times performing an operation will create this output for you. Other times, you may want a shell <code>nifti</code> object.</p>
<div id="copying-header-information" class="section level3">
<h3 class="hasAnchor">
<a href="#copying-header-information" class="anchor"></a>Copying header information</h3>
<p>If you have an array, you can simply write:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a>dims =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(eve)</span>
<span id="cb78-2"><a href="#cb78-2"></a>arr =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/prod.html">prod</a></span>(dims)), <span class="dt">dim =</span> dims)</span>
<span id="cb78-3"><a href="#cb78-3"></a>nim =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/oro.nifti/man/nifti.html">nifti</a></span>(arr)</span>
<span id="cb78-4"><a href="#cb78-4"></a>nim</span></code></pre></div>
<pre><code>## NIfTI-1 format
##   Type            : nifti
##   Data Type       : 2 (UINT8)
##   Bits per Pixel  : 8
##   Slice Code      : 0 (Unknown)
##   Intent Code     : 0 (None)
##   Qform Code      : 0 (Unknown)
##   Sform Code      : 0 (Unknown)
##   Dimension       : 91 x 109 x 91
##   Pixel Dimension : 1 x 1 x 1
##   Voxel Units     : Unknown
##   Time Units      : Unknown</code></pre>
<p>but the header information of the <code>nifti</code> output <code>nim</code> does not match that of <code>eve</code>. The <code>copyNIfTIHeader</code> function allows you to…copy the NIfTI header:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a>nim =<span class="st"> </span><span class="kw"><a href="../reference/copyNIfTIHeader.html">copyNIfTIHeader</a></span>(<span class="dt">img =</span> eve, <span class="dt">arr =</span> nim)</span>
<span id="cb80-2"><a href="#cb80-2"></a>nim</span></code></pre></div>
<pre><code>## NIfTI-1 format
##   Type            : nifti
##   Data Type       : 4 (INT16)
##   Bits per Pixel  : 16
##   Slice Code      : 0 (Unknown)
##   Intent Code     : 0 (None)
##   Qform Code      : 0 (Unknown)
##   Sform Code      : 4 (MNI_152)
##   Dimension       : 91 x 109 x 91
##   Pixel Dimension : 2 x 2 x 2
##   Voxel Units     : mm
##   Time Units      : sec</code></pre>
</div>
<div id="creating-a-shell" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-a-shell" class="anchor"></a>Creating a “shell”</h3>
<p>The <code>niftiarr</code> function does much of the same functionality of <code>copyNIfTIHeader</code>, but <code>copyNIfTIHeader</code> you have an <code>array</code> or <code>nifti</code> in the <code>arr</code> argument. If you wanted a <code>nifti</code> object with the same header as <code>eve</code>, but all zeroes, you can use <code>niftiarr</code>:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a>zeroes =<span class="st"> </span><span class="kw"><a href="../reference/niftiarr.html">niftiarr</a></span>(eve, <span class="dv">0</span>)</span></code></pre></div>
<p>The main difference is the line in <code>niftiarr</code>:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a><span class="cf">if</span> (<span class="op">!</span><span class="kw">is</span>(arr, <span class="st">"array"</span>)){</span>
<span id="cb83-2"><a href="#cb83-2"></a>  arr =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(arr, <span class="dt">dim=</span><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(img))</span>
<span id="cb83-3"><a href="#cb83-3"></a>}</span></code></pre></div>
<p>which implies that if you pass in a <code>vector</code> instead of an <code>array</code>, it will create an <code>array</code> on the fly. Sometimes you want an operation to error if <code>arr</code> is not an <code>array</code> (as in <code>copyNIfTIHeader</code>) or be able to pass in a vector and get the correct output <code>niftiarr</code>.</p>
<p>Technical note: This code is legacy and somewhat old and probably can (and may be) replaced by making <code>copyNIfTIHeader</code> a generic and having different versions for when <code>arr</code> is an <code>array</code> or <code>vector</code>.</p>
</div>
</div>
<div id="masking" class="section level2">
<h2 class="hasAnchor">
<a href="#masking" class="anchor"></a>Masking</h2>
<p>Many times you mask an image based on a binary mask. This means any values where the mask is 1, the values will remain, and if the mask is zero or <code>NA</code>, they will be changed (to either zero or <code>NA</code>).</p>
<p>The operation of masking is simply multiplication, multiplying an array by a binary (with or without <code>NA</code>s). Although this is simple, we have created the <code>mask_img</code> function to perform some checking on the <code>mask</code>, such as are all values 0/1. It also has the argument <code>allow.NA</code>, which denotes whether <code>NA</code>s should be allowed or not in the mask.</p>
<p>Here we will simply mask out values of <code>eve</code> that are less than the mean:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a>eve_masked =<span class="st"> </span><span class="kw"><a href="../reference/mask_img.html">mask_img</a></span>(eve, eve <span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(eve))</span></code></pre></div>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a><span class="kw"><a href="../reference/ortho2.html">ortho2</a></span>(eve_masked)</span></code></pre></div>
<p><img src="neurobase_files/figure-html/plot_mask-1.png" width="700"></p>
</div>
<div id="vectorizing-a-nifti" class="section level2">
<h2 class="hasAnchor">
<a href="#vectorizing-a-nifti" class="anchor"></a>Vectorizing a <code>nifti</code>
</h2>
<p>To convert a <code>nifti</code> to a <code>vector</code>, you can simply use the <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> operator:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a>vals =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(eve)</span>
<span id="cb86-2"><a href="#cb86-2"></a><span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span>(vals)</span></code></pre></div>
<pre><code>## [1] "integer"</code></pre>
<p>Note an <code>array</code> can be reconstructed by using <code><a href="https://rdrr.io/r/base/array.html">array(vals, dim = dim(eve))</a></code> and will be in the correct order as the way R creates vectors and arrays.</p>
<p>From these values we can do all the standard plotting/manipulations of data. For example, let’s do a marginal density of the values:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(vals))</span></code></pre></div>
<p><img src="neurobase_files/figure-html/dens-1.png" width="700"></p>
<p>This plot is good, but it’s over all voxels in the image, which are mostly zero due to the background. Therefore we see a large spike at zero, but not much information of the distribution of values within the mask. We need to subset the values by the mask.</p>
<div id="subsetting-via-masks" class="section level3">
<h3 class="hasAnchor">
<a href="#subsetting-via-masks" class="anchor"></a>Subsetting via masks</h3>
<p>In a previous example, we calculated the mean of <code>eve</code> over the entire image. Many times we want to calculate values over a mask. For example, let’s get the mean of all voxels in the mask, where the mask is any value of <code>eve</code> greater than zero. We can do this by subsetting the values in the mask and then calculating the mean:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a>vals =<span class="st"> </span>eve[ eve <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> ]</span>
<span id="cb89-2"><a href="#cb89-2"></a><span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(vals)</span></code></pre></div>
<pre><code>## [1] 82.90267</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a><span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(eve)</span></code></pre></div>
<pre><code>## [1] 82.89716</code></pre>
<p>We see that the mean of the voxels in the mask versus all voxels is very different, because the voxels not in the mask are simply adding zeroes to the calculation. We could simply do the same by making zero voxels <code>NA</code> and adding the <code>na.rm</code> argument to <code>TRUE</code> for the mean.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a>mask =<span class="st"> </span>eve <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span></span>
<span id="cb93-2"><a href="#cb93-2"></a>mask[ mask <span class="op">==</span><span class="st"> </span><span class="dv">0</span> ] =<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb93-3"><a href="#cb93-3"></a>eve_masked =<span class="st"> </span><span class="kw"><a href="../reference/mask_img.html">mask_img</a></span>(eve, mask)</span>
<span id="cb93-4"><a href="#cb93-4"></a><span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(eve_masked)</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a><span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(eve_masked, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 82.90267</code></pre>
<p>Again, as <code>nifti</code> objects inherits properties from <code>array</code> objects, we can subset using logical indices, as above in <code>mask == 0</code> and could use indices such as <code><a href="https://rdrr.io/r/base/which.html">which(mask == 0)</a></code>.</p>
<p>We can do a marginal density of the values only in the mask:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a>vals =<span class="st"> </span>eve[ eve <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> ]</span></code></pre></div>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(vals))</span></code></pre></div>
<p><img src="neurobase_files/figure-html/dens_2-1.png" width="700"></p>
<p>For most plotting functions, we can also add in a <code>mask</code> argument to plot values only for that masked data.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(eve, <span class="dt">mask =</span> eve <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>))</span></code></pre></div>
<p><img src="neurobase_files/figure-html/dens_with_mask-1.png" width="700"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#the-nifti-object">The nifti object</a>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#s4-implementation">S4 Implementation</a></li>
      </ul>
</li>
      <li><a href="#other-objects">Other objects</a></li>
      <li>
<a href="#nifti-inputoutput-readniiwritenii-vs--readniftiwritenifti">NIfTI Input/Output: <code>readnii</code>/<code>writenii</code> vs. <code>readNIfTI</code>/<code>writeNIfTI</code></a>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#option-reorient-false">Option <code>reorient = FALSE</code></a></li>
      </ul>
</li>
      <li>
<a href="#operations-of-nifti-objects">Operations of <code>nifti</code> objects</a>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#logical-operators">Logical operators</a></li>
      <li><a href="#arithmetic-on-nifti-objects">Arithmetic on <code>nifti</code> objects</a></li>
      <li><a href="#summaries">Summaries</a></li>
      </ul>
</li>
      <li>
<a href="#visualization-of-nifti-objects">Visualization of <code>nifti</code> objects</a>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#orthographic-view">Orthographic view</a></li>
      <li><a href="#single-slice-view">Single slice view</a></li>
      <li><a href="#overlaying-slices">Overlaying slices</a></li>
      <li><a href="#dropping-empty-dimensions">Dropping empty dimensions</a></li>
      </ul>
</li>
      <li>
<a href="#manipulating-nifti-images">Manipulating <code>nifti</code> images</a>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#creating-copies-of-nifti">Creating copies of <code>nifti</code></a></li>
      <li><a href="#masking">Masking</a></li>
      <li><a href="#vectorizing-a-nifti">Vectorizing a <code>nifti</code></a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by John Muschelli.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
